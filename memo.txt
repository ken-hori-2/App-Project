export FLASK_APP=action_list_app
export FLASK_ENV=development




# How to use
1. 行動を登録
  cd App-Project/
  sudo flask --app action_list_app run --port 80 --host 0.0.0.0

2. 行動を予測
  cd App-Project/
  cd action_list_app/
  sudo python model_main_CONTINUE.py
  sudo python model_main_CONTINUE_0327.py



# Done
行動欄に入力するだけで、時刻も入力
行動は英語からラベルに変換されてcsvファイルに保存
タイムゾーンをJSTに変更

# Todo
action = -1 のデータは省く（学習に使わない）
日付と場所は入力しない（マルチデータにするなら場所は残しておく）


# Done
deploy完了（仮）
新しく作成したEC2(action-prediction)上にtorch==2.1.2, torchvision==0.16.2をインストール
→このインスタンスをAMI化

# Todo
webの体裁を整える
pngをweb上に表示する




2024/03/04
# Todo
model_main.py / L319, L739
"これはテストデータ >> 次回は現在時刻に一番近い時間=t+1となるようにする >> ということは推論結果は未来の時刻にならないといけない（＝学習データは現在時刻以前になるようにする）"


2024/03/05
# Todo
縦軸（予測対象の行動）のソート：ある時間に対するある行動の確率をそれぞれ算出（学習して分類）して、%で出力→各時間に対して最も確率が高い行動になるようにソート…分類してラベル付けして、その順にソート
横軸は予測した一時刻を先にcsvに書いておく（行動は空白でOK）:1日8回行動を予測するとして、8×7日=56個予測が必要（1週間予測する場合）…ちなみに現在の入力は17個/日くらい




2024/03/18
# Done
コードの整理
model_main_CONTINUE.pyが現在のメイン
srcが小さい値になってしまっている原因を特定（model_main_CONTINUE.py L396)

# Todo
今は、「推論結果のうち現在時刻（または、指定した時刻）よりも未来の時刻の推論結果を取り出して提示する」ようにするところを、ダミーデータで推論結果を再現している(df2:pred_date_actions_pre.csv)
  -> ダミーデータを推論結果に置き換える

予測する際に、予測したい日時が、学習の際の日時と間隔が違う場合にうまく推論できない
  -> 例：学習時は細かい時系列データ　推論時は、間隔がだいぶあいたデータ（半日に一回推論する程度　など）
    -> 今のままでは推論したい時刻の間が空きすぎて、うまく推論できていない状態
      -> なので、学習時のデータと推論する日時は日付の感覚をそろえる必要がある（/home/ubuntu/App-Project/action_list_app/upload_data/images/actions_by_load_model.pngを見ればわかる）


2024/03/27
# Done
memo.txt の整理
model_main_CONTINUE_0327.py の作成
  -> 2024/03/27時点でのメイン(CONTINUEから予測する日付の間隔を調整したコード)
  -> また、予測対象のデータを7個追加

input_data_from_local_0327.csv の作成
  -> 予測対象のデータを7個追加

# Todo
現在時刻に最も近い未来の時刻の予測する行動(df2:pred_date_actions_pre_0327.csv)を実際の推論結果が格納される様に書き換える

2024/03/28
# Done
model_main_CONTINUE_0327.py の更新
df2:pred_date_actions_pre_0327.csv を実際の推論結果が格納される様に書き換える
  -> df2:pred_date_actions.csv に推論結果を出力して、それをdf2(現在時刻に基づいた行動の出力)

# Todo
ひとまず推論モデルの作成完了
  -> 実際に日々入力したデータをもとに学習、推論する
    -> Pytorchによる発展ディープラーニングを学ぶ
  -> EC2だけではないwebサーバーを構築する
    -> ブラックベルトやハンズオン、資格の勉強をする








# history

ubuntu@ip-172-31-88-52:~/App-Project/action_list_app$ history
    1  clear
    2  ls
    3  sudo apt install python-is-python3
    4  sudo apt update
    5  sudo apt install python3-pip
    6  sudo pip install flask
    7  mkdir model
    8  python -m venv model
    9  apt install python3.8-venv
   10  sudo apt install python3.8-venv
   11  python -m venv model
   12  source model/bin/activate
   13  pip install flask
   14  pip install numpy
   15  pip install torch torchvision
   16  ssh -i "aws_ken.pem" ubuntu@ec2-3-93-10-221.compute-1.amazonaws.com
   17  free -m
   18  python -V
   19  python
   20  deactivate
   21  rm model/
   22  rm -r model
   23  ls
   24  history
   25  mkdir model
   26  python -m venv model
   27  source model/bin/activate
   28  ls
   29  poetry source add --priority=explicit pytorch-cpu https://download.pytorch.org/whl/cpu
   30  pip install torch==1.5.0+cpu torchvision==0.6.0+cpu -f https://download.pytorch.org/whl/torch_stable.html
   31  python -V
   32  python
   33  pip install matplotlib
   34  ls
   35  cd model/
   36  ls
   37  free -m
   38  ls
   39  mv classifier.py cnn.py
   40  python cnn.py
   41  pip install flask
   42  python cnn.py
   43  sudo cnn.py
   44  sudo python cnn.py
   45  python cnn.py
   46  where torch
   47  which torch
   48  which python
   49  pip install torch==1.5.0+cpu
   50  source lib64/python3.8/site-packages/torch
   51  python cnn.py
   52  sido pyhton cnn.py
   53  sudo pyhton cnn.py
   54  sudo python cnn.py
   55  python cnn.py
   56  python simple.py
   57  sudo python simple.py
   58  python simple.py
   59  sudo python simple.py
   60  python main__cnn_model.py
   61  pip install PIL
   62  pip install pillow
   63  python main__cnn_model.py
   64  sudo pip install pillow
   65  sudo pip install torch==1.5.0+cpu
   66  sudo pip install torch
   67  sudo pip install torch==1.5.0
   68  sudo python cnn.py
   69  sudo pip install torchvision==0.6.0
   70  sudo python cnn.py
   71  history
   72  python main__cnn_model.py
   73  sudo python main__cnn_model.py
   74  sudo pip install matplotlib
   75  sudo python main__cnn_model.py
   76  sudo pip install pillow
   77  sudo python main__cnn_model.py
   78  sudo python main__cnn_model.py
   79  sudo python horiuchi-model.py
   80  python horiuchi-model.py
   81  clear
   82  history
   83  python horiuchi-model.py
   84  git init
   85  git add static/
   86  git add templates/
   87  git add cnn.py
   88  git add horiuchi-model.py
   89  git add main.py
   90  git add model_cnn.pth
   91  git add model-for-ec2-mlp.param
   92  git add model-for-ec2.param
   93  git add result-data.png
   94  git add result-figure.png
   95  git add simple.py
   96  git commit -m "1st commit for model in ec2"
   97  git remote add origin https://github.com/ken-hori-2/aws-ec2.git
   98  git push origin main
   99  git branch -M main
  100  git push -u origin main
  101  git remote add origin https://github.com/ken-hori-2/aws-ec2.git
  102  git push -u origin main
  103  git log
  104  git status
  105  git branch -a
  106  git push o-f rigin main
  107  git push -f origin main
  108  git remote remove origin
  109  git remote add origin https://github.com/ken-hori-2/aws-ec2.git
  110  git push -u origin main
  111  git remote add origin https://github.com/ken-hori-2/aws-ec2.git
  112  git remote remove origin
  113  git remote add origin https://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@github.com/ken-hori-2/aws-ec2.git
  114  git push -u origin main
  115  git add train_data/
  116  git commit -m "2nd commit(add data)"
  117  git push -u origin main
  118  git pull
  119  git add README.md
  120  git commit -m "2nd commit(add data)"
  121  git push -u origin main
  122  sudo python horiuchi-model-for-App.py
  123  sudo python horiuchi-model-for-App.py
  124  cd model/
  125  sudo python horiuchi-model-for-App.py
  126  cd model
  127  git add horiuchi-model-for-App.py
  128  git commit -m "add AI-App"
  129  git push origin main
  130  cd model/
  131  python horiuchi-model.py
  132  cd m,ode
  133  cd model/
  134  python test.py
  135  cd model/
  136  python test.py
  137  python horiuchi-model.py
  138  python te
  139  python test.py
  140  python horiuchi-model.py
  141  git add result.png
  142  git add horiuchi-model.py
  143  git add horiuchi-model-for-App.py
  144  git add test.py
  145  git commit -m "図の保存方法の変更"
  146  git push origin main
  147  cd model/
  148  sudo python HM4A-train.py
  149  sudo python HM4A-val.py
  150  sudo python HM4A-train.py
  151  sudo python HM4A-train-or-val.py
  152  sudo python HM4A-train-or-val.py
  153  cd model/
  154  clear
  155  git add upload_data/
  156  git add result.png
  157  git add HM4A-only-val.py
  158  git add HM4A-train-or-val.py
  159  git commit -m "Horiuchi Model For App"
  160  git push origin main
  161  git add src/
  162  git add fig/
  163  git add src/
  164  git commit -m "Create src/ fig/"
  165  git commit -m "Create src/ fig/"git push origin main.py
  166  git push origin main
  167  git add src/
  168  git commit -m "Create src/ fig/"
  169  git push origin main
  170  git pull
  171  git pull origin
  172  git add src/
  173  git commit -m "Create src/ fig/"
  174  git push origin main
  175  git add templates/
  176  git commit -m "change templates"
  177  clerar
  178  clear
  179  git push origin main
  180  ls
  181  cd ..
  182  python run.py
  183  sudo python run.py
  184  cd model/
  185  cd src/
  186  sudo python run.py
  187  sudo python HM4A-train-or-val.py
  188  cd ..
  189  git add src/
  190  git add static/
  191  git add my_templates/
  192  git commit -m "Edit Website"
  193  git push origin  ai
  194  git push origin main
  195  cd src/
  196  sudo python HM4A-only-val.py
  197  cd ..
  198  git add src/
  199  git commit -m "Edit Website"
  200  git push origin main
  201  git pull
  202  git pull origin
  203  git add README.md
  204  git commit -m "Edit README"
  205  git push origin main
  206  git add public/
  207  git commit -m "Edit README"
  208  git push origin main
  209  git add public
  210  git commit -m "Edit README"
  211  git add public
  212  git commit -m "Edit README"
  213  git push origin main
  214  git add public
  215  git commit -m "Edit README"
  216  git push origin main
  217  git pull
  218  git fetch origin
  219  git merge origin/main
  220  clear
  221  ls
  222  git clone https://github.com/ken-hori-2/App-Project.git
  223  ls
  224  cd App-Project/
  225  sudo flask --app action_list_app run --port 80 --host 0.0.0.0
  226  ls
  227  sudo flask --app action_list_app run --port 80 --host 0.0.0.0
  228  cls
  229  clear
  230  ls
  231  cd ..
  232  ls
  233  cd
  234  cd App-Project/
  235  ls
  236  cd action_list_app/
  237  python
  238  clear
  239  python main.py
  240  cd ..
  241  cd action_list_app/
  242  python main.py
  243  sudo python main.py
  244  cd ..
  245  python action_list_app/main.py
  246  history
  247  code command.txt
  248  sudo snap install code
  249  touch command.txt
  250  open command.txt
  251  sudo flask --app action_list_app run --port 80 --host 0.0.0.0
  252  netstat -pntle  | grep :80
  253  sudo netstat -pntle  | grep :80
  254  ps ax | grep rails
  255  lsof -i | grep http
  256  sudo flask --app action_list_app run --port 80 --host 0.0.0.0
  257  kill -9 | grep http
  258  sudo flask --app action_list_app run --port 80 --host 0.0.0.0
  259  kill -9 2387
  260  sudo flask --app action_list_app run --port 80 --host 0.0.0.0
  261  netstat -abno | MORE
  262  netstat -anp |grep 80
  263  lsof -i 80
  264  lsof -i :80
  265  sudo flask --app action_list_app run --port 80 --host 0.0.0.0
  266  /usr/sbin/lsof -i | grep httpd
  267  lsof -i | grep httpd
  268  kill 9 lsof -i | grep httpd
  269  kill 9 | grep httpd
  270  sudo flask --app action_list_app run --port 80 --host 0.0.0.0
  271  kill -9 2387
  272  sudo lsof -i -P | grep ":80"
  273  kill -9 2214
  274  sudo flask --app action_list_app run --port 80 --host 0.0.0.0
  275  sudo service httpd stop
  276  sudo flask --app action_list_app run --port 80 --host 0.0.0.0
  277  sudo apachectl stop
  278  lsof -i :80
  279  sudo flask --app action_list_app run --port 80 --host 0.0.0.0
  280  curl -i localhost:80
  281  ps -fA | grep python
  282  kill 2514
  283  kill 1728
  284  sudo flask --app action_list_app run --port 80 --host 0.0.0.0
  285  ps -fA | grep python
  286  kill 2214
  287  kill -9 2214
  288  kill 2213
  289  ps -fA | grep python
  290  kill 2214
  291  kill $PID
  292  sudo lsof -i:80
  293  kill 2214
  294  sudo kill 2214
  295  sudo flask --app action_list_app run --port 80 --host 0.0.0.0
  296  sudo lsof -i:80
  297  kill -9 2214
  298  sudo lsof -i -P | grep "LISTEN"
  299  sudo kill 2214
  300  sudo lsof -i -P | grep "LISTEN"
  301  kill 32246
  302  kill 2214
  303  lsof -i -P | grep 80
  304  lsof -i -P | grep 8080
  305  ps ax | grep rails
  306  kill 2704
  307  lsof -i:80
  308  kill
  309  lsof -i | grep http
  310  lsof -i | grep httpd
  311  sudo lsof -i | grep httpd
  312  netstat -anp lgrep
  313  sudo apt install net-tools
  314  netstat -anp lgrep
  315  netstat -anp lgrep 80
  316  sudo apachectl stop
  317  sudo apt install apachctl
  318  sudo apt install apacehctl
  319  sudo apt install apachectl
  320  lsof -i -P | grep 80
  321  sudo flask --app action_list_app run --port 80 --host 0.0.0.0
  322  sudo lsof -i | grep http
  323  sudo kill -9 2214
  324  sudo flask --app action_list_app run --port 80 --host 0.0.0.0
  325  cd App-Project/
  326  sudo flask --app action_list_app run --port 80 --host 0.0.0.0
  327  netstat -ano | findstr 80
  328  cd App-Project/
  329  sudo flask --app action_list_app run --port 80 --host 0.0.0.0
  330  sudo lsof -i | grep http
  331  sudo kill -99 3094
  332  sudo kill -9 3094
  333  sudo flask --app action_list_app run --port 80 --host 0.0.0.0
  334  cd App-Project/
  335  cd action_list_app/
  336  python model.py
  337  sudo pip install pandas
  338  sudo python model.py
  339  python deploy.py
  340  sudo pip install scikit-learn
  341  python deploy.py
  342  sudo python deploy.py
  343  sudo pip install torch==2.1.2+cpu torchvision==0.16.2+cpu
  344  sudo pip install torch==2.1.2+cpu
  345  sudo pip install torch==2.1.
  346  sudo pip install torch==2.1.2
  347  sudo python deploy.py
  348  python --vertsion
  349  python --version
  350  sudo pip install torch
  351  sudo pip install torch==2.1.2
  352  history




  14  sudo pip install torch==2.1.2
  20  sudo pip install torchvision==0.16.2
  
  25  cd App-Project/
  26  git add .
  27  git commit -m "deploy is complete."
  29  git config --global user.email ken-hori-2
  38  git push origin main
  
  40  git config --global user.email
  
  48  cd App-Project/
  49  cd action_list_app/
  50  sudo python model.py


# module
sudo pip install torch==2.1.2
sudo pip install torchvision==0.16.2
sudo apt install python-is-python3
sudo apt update
sudo apt install python3-pip
sudo pip install flask
sudo pip install matplotlib
sudo pip install pandas
sudo pip install scikit-learn
sudo pip install numpy

# git Token (2024/03/05)
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

# portが既に使用されている場合の解決方法
ubuntu@ip-172-31-88-52:~/App-Project$ sudo lsof -i | grep http
flask     2214            root    3u  IPv4  32246      0t0  TCP *:http (LISTEN)
ubuntu@ip-172-31-88-52:~/App-Project$ sudo kill -9 2214